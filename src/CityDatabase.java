import java.util.*;

public class CityDatabase {
    private static final Map<String, Set<String>> citiesByFirstLetter = new HashMap<>();
    private static final Set<String> allCities = new HashSet<>();

    static {
        // Инициализация базы данных городов
        addCities("А", Arrays.asList(
            "Абакан", "Азов", "Александров", "Алексин", "Альметьевск", "Анапа", "Ангарск", "Анжеро-Судженск",
            "Апатиты", "Арзамас", "Армавир", "Арсеньев", "Артем", "Архангельск", "Асбест", "Астрахань", "Ачинск"
        ));
        addCities("Б", Arrays.asList(
            "Балаково", "Балахна", "Балашиха", "Балашов", "Барнаул", "Батайск", "Белгород", "Белебей",
            "Белово", "Белогорск", "Белорецк", "Белореченск", "Бердск", "Березники", "Березовский", "Бийск",
            "Биробиджан", "Благовещенск", "Бор", "Борисоглебск", "Боровичи", "Братск", "Брянск", "Бугульма",
            "Буденновск", "Бузулук", "Буйнакск"
        ));
        addCities("В", Arrays.asList(
            "Великие Луки", "Великий Новгород", "Верхняя Пышма", "Видное", "Владивосток", "Владикавказ",
            "Владимир", "Волгоград", "Волгодонск", "Волжск", "Волжский", "Вологда", "Вольск", "Воркута",
            "Воронеж", "Воскресенск", "Воткинск", "Всеволожск", "Выборг", "Выкса", "Вязьма"
        ));
        addCities("Г", Arrays.asList(
            "Гатчина", "Геленджик", "Георгиевск", "Глазов", "Горно-Алтайск", "Грозный", "Грязи", "Губаха",
            "Губкин", "Гудермес", "Гуково", "Гусь-Хрустальный"
        ));
        addCities("Д", Arrays.asList(
            "Дербент", "Дзержинск", "Димитровград", "Дмитров", "Долгопрудный", "Домодедово", "Донецк", "Дубна"
        ));
        addCities("Е", Arrays.asList(
            "Евпатория", "Егорьевск", "Ейск", "Екатеринбург", "Елабуга", "Елец", "Ессентуки"
        ));
        addCities("Ж", Arrays.asList(
            "Железногорск", "Жигулевск", "Жуковский"
        ));
        addCities("З", Arrays.asList(
            "Заречный", "Зеленогорск", "Зеленодольск", "Златоуст"
        ));
        addCities("И", Arrays.asList(
            "Иваново", "Ивантеевка", "Ижевск", "Избербаш", "Иркутск", "Искитим", "Ишим", "Ишимбай"
        ));
        addCities("Й", Arrays.asList(
            "Йошкар-Ола"
        ));
        addCities("К", Arrays.asList(
            "Казань", "Калининград", "Калуга", "Каменск-Уральский", "Каменск-Шахтинский", "Камышин",
            "Канск", "Каспийск", "Кемерово", "Керчь", "Кинешма", "Кириши", "Киров", "Кирово-Чепецк",
            "Киселевск", "Кисловодск", "Клин", "Клинцы", "Ковров", "Когалым", "Коломна", "Комсомольск-на-Амуре",
            "Копейск", "Королев", "Кострома", "Котлас", "Красногорск", "Краснодар", "Краснокаменск",
            "Краснокамск", "Краснотурьинск", "Красноярск", "Кропоткин", "Крымск", "Кстово", "Кубинка",
            "Кудрово", "Кузнецк", "Кумертау", "Кунгур", "Курган", "Курск", "Курчатов", "Кызыл"
        ));
        addCities("Л", Arrays.asList(
            "Лабинск", "Лениногорск", "Ленинск-Кузнецкий", "Лесосибирск", "Липецк", "Лиски", "Лобня",
            "Лысьва", "Лыткарино", "Люберцы"
        ));
        addCities("М", Arrays.asList(
            "Магадан", "Магнитогорск", "Майкоп", "Махачкала", "Междуреченск", "Мелеуз", "Миасс", "Минеральные Воды",
            "Минусинск", "Мирный", "Михайловка", "Михайловск", "Мичуринск", "Москва", "Мурманск", "Муром", "Мытищи"
        ));
        addCities("Н", Arrays.asList(
            "Набережные Челны", "Назарово", "Назрань", "Нальчик", "Наро-Фоминск", "Находка", "Невинномысск",
            "Нерюнгри", "Нефтекамск", "Нефтеюганск", "Нижневартовск", "Нижнекамск", "Нижний Новгород",
            "Нижний Тагил", "Новоалтайск", "Новокузнецк", "Новокуйбышевск", "Новомосковск", "Новороссийск",
            "Новосибирск", "Новотроицк", "Новоуральск", "Новочебоксарск", "Новочеркасск", "Новошахтинск",
            "Новый Уренгой", "Ногинск", "Норильск", "Ноябрьск", "Нягань"
        ));
        addCities("О", Arrays.asList(
            "Обнинск", "Одинцово", "Озерск", "Октябрьский", "Омск", "Орел", "Оренбург", "Орехово-Зуево",
            "Орск", "Отрадный"
        ));
        addCities("П", Arrays.asList(
            "Павлово", "Павловский Посад", "Пенза", "Первоуральск", "Пермь", "Петрозаводск", "Петропавловск-Камчатский",
            "Подольск", "Полевской", "Прокопьевск", "Прохладный", "Псков", "Пушкино", "Пятигорск"
        ));
        addCities("Р", Arrays.asList(
            "Раменское", "Ревда", "Реутов", "Ржев", "Рославль", "Россошь", "Ростов-на-Дону", "Рубцовск",
            "Рыбинск", "Рязань"
        ));
        addCities("С", Arrays.asList(
            "Салават", "Сальск", "Самара", "Санкт-Петербург", "Саранск", "Сарапул", "Саратов", "Саров",
            "Сатка", "Саяногорск", "Севастополь", "Северодвинск", "Северск", "Сергиев Посад", "Серов",
            "Серпухов", "Сертолово", "Сибай", "Симферополь", "Славянск-на-Кубани", "Смоленск", "Соликамск",
            "Солнечногорск", "Сосновый Бор", "Сочи", "Ставрополь", "Старый Оскол", "Стерлитамак", "Ступино",
            "Сургут", "Сызрань", "Сыктывкар"
        ));
        addCities("Т", Arrays.asList(
            "Таганрог", "Тамбов", "Тверь", "Тимашевск", "Тихвин", "Тихорецк", "Тобольск", "Тольятти",
            "Томск", "Троицк", "Туапсе", "Туймазы", "Тула", "Тюмень"
        ));
        addCities("У", Arrays.asList(
            "Узловая", "Улан-Удэ", "Ульяновск", "Урус-Мартан", "Усолье-Сибирское", "Уссурийск", "Усть-Илимск",
            "Уфа", "Ухта"
        ));
        addCities("Ф", Arrays.asList(
            "Феодосия", "Фрязино"
        ));
        addCities("Х", Arrays.asList(
            "Хабаровск", "Ханты-Мансийск", "Хасавюрт", "Химки"
        ));
        addCities("Ч", Arrays.asList(
            "Чайковский", "Чапаевск", "Чебоксары", "Челябинск", "Черемхово", "Череповец", "Черкесск",
            "Черногорск", "Чехов", "Чистополь", "Чита"
        ));
        addCities("Ш", Arrays.asList(
            "Шадринск", "Шали", "Шахты", "Шуя"
        ));
        addCities("Щ", Arrays.asList(
            "Щелково", "Щекино", "Щербинка"
        ));
        addCities("Э", Arrays.asList(
            "Электросталь", "Элиста", "Энгельс"
        ));
        addCities("Ю", Arrays.asList(
            "Южно-Сахалинск", "Юрга"
        ));
        addCities("Я", Arrays.asList(
            "Якутск", "Ялта", "Ярославль"
        ));
    }

    private static void addCities(String firstLetter, List<String> cities) {
        citiesByFirstLetter.put(firstLetter, new HashSet<>(cities));
        allCities.addAll(cities);
    }

    public static boolean isValidCity(String city) {
        return allCities.contains(city);
    }

    public static boolean isValidNextCity(String lastCity, String nextCity) {
        if (lastCity == null || lastCity.isEmpty()) {
            return isValidCity(nextCity);
        }

        String lastLetter = lastCity.substring(lastCity.length() - 1).toUpperCase();
        // Проверяем специальные случаи
        if (lastLetter.equals("Ь") || lastLetter.equals("Ы") || lastLetter.equals("Й")) {
            lastLetter = lastCity.substring(lastCity.length() - 2, lastCity.length() - 1).toUpperCase();
        }

        Set<String> validCities = citiesByFirstLetter.get(lastLetter);
        return validCities != null && validCities.contains(nextCity);
    }

    public static Set<String> getCitiesByFirstLetter(String letter) {
        return citiesByFirstLetter.getOrDefault(letter.toUpperCase(), new HashSet<>());
    }

    public static Set<String> getAllCities() {
        return new HashSet<>(allCities);
    }
} 